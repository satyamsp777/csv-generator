<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSV Generator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
      }

      h1 {
        text-align: center;
      }

      #csvForm {
        max-width: 600px;
        margin: 0 auto;
      }

      #entryContainer {
        margin-bottom: 20px;
      }

      .column {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
      }

      .column h2 {
        font-size: 18px;
        margin-top: 0;
      }

      .column label {
        display: block;
        margin-bottom: 5px;
      }

      .column input[type="text"],
      .column input[type="number"] {
        width: 100%;
        padding: 5px;
        font-size: 14px;
      }

      .column button {
        margin-top: 10px;
        background-color: #f44336;
        color: #fff;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
      }

      .button-container {
        text-align: center;
        margin-top: 20px;
      }

      .button-container button {
        background-color: #4caf50;
        color: #fff;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h1>CSV Generator</h1>

    <form id="csvForm">
      <div id="entryContainer"></div>

      <div class="button-container">
        <button type="button" onclick="addColumn()">Add Entry</button>
        <button type="submit">Submit</button>
      </div>
    </form>

    <script>
      var numColumns = 1;

      function addColumn() {
        var entryContainer = document.getElementById("entryContainer");

        // Check if previous inputs are filled
        var previousInputs = entryContainer.querySelectorAll("input[required]");
        var allFilled = true;

        for (var i = 0; i < previousInputs.length; i++) {
          if (!previousInputs[i].value) {
            allFilled = false;
            break;
          }
        }

        // Only add a new column if all previous inputs are filled
        if (allFilled) {
          var div = document.createElement("div");
          div.classList.add("column");
          div.id = `column_${numColumns}`;
          div.innerHTML = `
          <h2>Entry ${numColumns}</h2>
          <label for="accountNo_${numColumns}">Account No:</label>
          <input type="number" id="accountNo_${numColumns}" name="accountNo_${numColumns}" required><br><br>
          <label for="name_${numColumns}">Name:</label>
          <input type="text" id="name_${numColumns}" name="name_${numColumns}" required><br><br>
          <label for="ifscCode_${numColumns}">IFSC Code:</label>
          <input type="text" id="ifscCode_${numColumns}" name="ifscCode_${numColumns}" oninput="this.value = this.value.toUpperCase()" pattern="[A-Za-z0-9]{11}" required><br><br>
          <label for="amount_${numColumns}">Amount:</label>
          <input type="number" id="amount_${numColumns}" name="amount_${numColumns}" required><br><br>
          <label for="username_${numColumns}">Username:</label>
          <input type="text" id="username_${numColumns}" name="username_${numColumns}" required><br><br>
          <button type="button" onclick="deleteColumn(${numColumns})">Delete</button>
        `;

          entryContainer.appendChild(div);

          numColumns++;
        } else {
          alert(
            "Please fill in all the required inputs before adding a new column."
          );
        }
      }

      function deleteColumn(columnNum) {
        var entryContainer = document.getElementById("entryContainer");
        var column = document.getElementById(`column_${columnNum}`);
        entryContainer.removeChild(column);

        // Re-arrange column numbering
        var columns = entryContainer.querySelectorAll(".column");
        numColumns--;

        for (var i = 0; i < columns.length; i++) {
          var column = columns[i];
          var columnIndex = i + 1;
          column.id = `column_${columnIndex}`;
          column.querySelector("h2").textContent = `Column ${columnIndex}`;
          column
            .querySelector('label[for^="name_"]')
            .setAttribute("for", `name_${columnIndex}`);
          column.querySelector('input[id^="name_"]').id = `name_${columnIndex}`;
          column.querySelector(
            'input[name^="name_"]'
          ).name = `name_${columnIndex}`;
          column
            .querySelector('label[for^="username_"]')
            .setAttribute("for", `username_${columnIndex}`);
          column.querySelector(
            'input[id^="username_"]'
          ).id = `username_${columnIndex}`;
          column.querySelector(
            'input[name^="username_"]'
          ).name = `username_${columnIndex}`;
          column
            .querySelector('label[for^="accountNo_"]')
            .setAttribute("for", `accountNo_${columnIndex}`);
          column.querySelector(
            'input[id^="accountNo_"]'
          ).id = `accountNo_${columnIndex}`;
          column.querySelector(
            'input[name^="accountNo_"]'
          ).name = `accountNo_${columnIndex}`;
          column
            .querySelector('label[for^="amount_"]')
            .setAttribute("for", `amount_${columnIndex}`);
          column.querySelector(
            'input[id^="amount_"]'
          ).id = `amount_${columnIndex}`;
          column.querySelector(
            'input[name^="amount_"]'
          ).name = `amount_${columnIndex}`;
          column
            .querySelector('label[for^="ifscCode_"]')
            .setAttribute("for", `ifscCode_${columnIndex}`);
          column.querySelector(
            'input[id^="ifscCode_"]'
          ).id = `ifscCode_${columnIndex}`;
          column.querySelector(
            'input[name^="ifscCode_"]'
          ).name = `ifscCode_${columnIndex}`;
          column
            .querySelector("button")
            .setAttribute("onclick", `deleteColumn(${columnIndex})`);
        }
      }

      document
        .getElementById("csvForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          var numEntries = numColumns - 1;

          if (numEntries < 1) {
            alert("Please add at least one entry before submitting.");
            return;
          }

          var entries = [];

          for (var i = 0; i < numEntries; i++) {
            var entry = {
              srNo: i + 1,
              beneName: document.getElementById(`name_${i + 1}`).value,
              imps: "IMPS",
              accountNo: document.getElementById(`accountNo_${i + 1}`).value,
              amount: document.getElementById(`amount_${i + 1}`).value,
              ifscCode: document.getElementById(`ifscCode_${i + 1}`).value,
              mobileNumber: "9522931970",
              description: document.getElementById(`username_${i + 1}`).value,
            };

            entries.push(entry);
          }

          // Generate CSV content
          var csvContent = "data:text/csv;charset=utf-8,";
          csvContent +=
            "SRNO,BENENAME,NEFT,ACCOUNT NUMBER,AMOUNT,IFSC CODE,91BENEMOBILE NUMBER,DESCRIPTION\n";

          entries.forEach(function (entry) {
            var values = Object.values(entry).map(function (value) {
              return '"' + value + '"';
            });
            csvContent += values.join(",") + "\n";
          });

          // Create a CSV file
          var encodedUri = encodeURI(csvContent);
          var link = document.createElement("a");
          link.setAttribute("href", encodedUri);
          link.setAttribute("download", "output.csv");
          document.body.appendChild(link);

          // Trigger the download
          link.click();

          // Cleanup
          document.body.removeChild(link);

          // Reset form and reload the page
          document.getElementById("csvForm").reset();
          window.location.reload();
        });
    </script>
  </body>
</html>
